"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[149],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return h}});var o=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var d=o.createContext({}),l=function(e){var t=o.useContext(d),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=l(e.components);return o.createElement(d.Provider,{value:t},e.children)},m="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,d=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=l(n),u=i,h=m["".concat(d,".").concat(u)]||m[u]||p[u]||a;return n?o.createElement(h,r(r({ref:t},c),{},{components:n})):o.createElement(h,r({ref:t},c))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,r=new Array(a);r[0]=u;var s={};for(var d in t)hasOwnProperty.call(t,d)&&(s[d]=t[d]);s.originalType=e,s[m]="string"==typeof e?e:i,r[1]=s;for(var l=2;l<a;l++)r[l]=n[l];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},4090:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return d},default:function(){return h},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return m}});var o=n(3117),i=n(102),a=(n(7294),n(3905)),r=["components"],s={id:"remove-ads",title:"Remove Ads",sidebar_label:"Remove ads"},d=void 0,l={unversionedId:"remove-ads",id:"remove-ads",title:"Remove Ads",description:"Removing ads is a great way to thank the people who support your site. You can make sure web monetized visitors have a smooth experience without forgoing monetization of the rest of your visitors.",source:"@site/docs/remove-ads.md",sourceDirName:".",slug:"/remove-ads",permalink:"/docs/remove-ads",draft:!1,editUrl:"https://github.com/WICG/webmonetization/tree/main/docs/remove-ads.md",tags:[],version:"current",frontMatter:{id:"remove-ads",title:"Remove Ads",sidebar_label:"Remove ads"},sidebar:"docs",previous:{title:"Exclusive content",permalink:"/docs/exclusive-content"},next:{title:"Micropayment counter",permalink:"/docs/counter"}},c={},m=[{value:"Code",id:"code",level:2},{value:"How does it work?",id:"how-does-it-work",level:2},{value:"Interactive example",id:"interactive-example",level:2}],p={toc:m},u="wrapper";function h(e){var t=e.components,n=(0,i.Z)(e,r);return(0,a.kt)(u,(0,o.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Removing ads is a great way to thank the people who support your site. You can make sure web monetized visitors have a smooth experience without forgoing monetization of the rest of your visitors."),(0,a.kt)("p",null,"Here's an example that removes its ads for web monetized visitors."),(0,a.kt)("h2",{id:"code"},"Code"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},"<head>\n  \x3c!-- this should be set to your own payment pointer --\x3e\n  <meta name=\"monetization\" content=\"$wallet.example.com/alice\">\n\n  <script>\n    const adCode = '<div style=\"border:1px solid #f00;color:red;margin:20px\">Ad! Buy product A! Ad!</div>'\n    function showAds () {\n      document.getElementById('ad').innerHTML = adCode\n    }\n\n    function removeAds () {\n      document.getElementById('ad').remove()\n    }\n\n    let hasPaid = false\n    if (document.monetization) {\n      document.monetization.addEventListener('monetizationstart', () => {\n        hasPaid = true\n        removeAds()\n      })\n    }\n\n    window.addEventListener('load', () => {\n      if (!document.monetization) {\n        showAds()\n      } else {\n        setTimeout(() => {\n          if (!hasPaid) {\n            showAds()\n          }\n        }, 3000)\n      }\n    })\n  <\/script>\n</head>\n\n<body>\n  <div id=\"ad\">\n  </div>\n\n  Here's some real content.\n</body>\n")),(0,a.kt)("p",null,"Users who visit the site without Web Monetization will see ads appear as soon as the page loads."),(0,a.kt)("p",null,"Users who have Web Monetization in their browser won't see the ads\nimmediately. There's a three-second grace period for Web Monetization to\ninitialize."),(0,a.kt)("p",null,"If Web Monetization:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Initializes before the three seconds are up, the ads never appear."),(0,a.kt)("li",{parentName:"ul"},"Fails to initialize within three seconds, the ads will load into the page."),(0,a.kt)("li",{parentName:"ul"},"Initializes any time after the three seconds are up, the ads will be removed.")),(0,a.kt)("h2",{id:"how-does-it-work"},"How does it work?"),(0,a.kt)("p",null,"This works a little bit differently from the ",(0,a.kt)("a",{parentName:"p",href:"/docs/exclusive-content"},"exclusive content example"),". The ad is not added to the page at all until you decide to show ads. That means images and trackers are not loaded for web monetized visitors."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const adCode = '<div style=\"border:1px solid #f00;color:red;margin:20px\">Ad! Buy product A! Ad!</div>'\nfunction showAds () {\n  document.getElementById('ad').innerHTML = adCode\n}\n")),(0,a.kt)("p",null,"If the visitor is web monetized, then we bind the ",(0,a.kt)("inlineCode",{parentName:"p"},"monetizationstart")," event. This triggers the removal of the ad once Web Monetization initializes."),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"hasPaid")," variable is used in the timer to see whether Web\nMonetization has already initialized when the grace period is over."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"let hasPaid = false\nif (document.monetization) {\n  document.monetization.addEventListener('monetizationstart', () => {\n    hasPaid = true\n    removeAds()\n  })\n}\n")),(0,a.kt)("p",null,"As soon as the page loads, any visitor who does not have Web Monetization\n(",(0,a.kt)("inlineCode",{parentName:"p"},"!document.monetization"),") sees the ad immediately. If the visitor ",(0,a.kt)("em",{parentName:"p"},"does")," have Web Monetization, the three-second timer starts. We check whether the\n",(0,a.kt)("inlineCode",{parentName:"p"},"monetizationstart")," event has fired when the timer is up. If Web Monetization hasn't initialized, the visitor is shown the ad."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"window.addEventListener('load', () => {\n  if (!document.monetization) {\n    showAds()\n  } else {\n    setTimeout(() => {\n      if (!hasPaid) {\n        showAds()\n      }\n    }, 3000)\n  }\n})\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"You might think of using ",(0,a.kt)("inlineCode",{parentName:"p"},"document.monetization.state")," instead of remembering\n",(0,a.kt)("inlineCode",{parentName:"p"},"hasPaid"),". But, the state can go back to being ",(0,a.kt)("inlineCode",{parentName:"p"},"stopped")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"pending")," if the user\nbackgrounds the tab. If they background your tab when the three seconds are over,\nthen a legitimately web monetized user might be shown ads!\nKeeping a ",(0,a.kt)("inlineCode",{parentName:"p"},"hasPaid")," variable is a better practice.")),(0,a.kt)("h2",{id:"interactive-example"},"Interactive example"),(0,a.kt)("p",null,"This example simulates hiding an ad from a web monetized visitor and showing the add to a non-web monetized visitor. The example doesn't require you to have Web Monetization enabled in your browser. No real payments are occurring."),(0,a.kt)("p",null,"Click the ",(0,a.kt)("strong",{parentName:"p"},"View as Web Monetized/non-Web Monetized visitor")," button to toggle your monetization state."),(0,a.kt)("p",null,"If you see the source files instead of the example, click ",(0,a.kt)("strong",{parentName:"p"},"View App")," in the bottom right."),(0,a.kt)("div",{class:"glitch-embed-wrap",style:{height:"420px",width:"100%"}},(0,a.kt)("iframe",{src:"https://glitch.com/embed/#!/embed/wm-ad-free-experience?path=README.md&previewSize=100",title:"wm-ad-free-experience on Glitch",allow:"geolocation; microphone; camera; midi; vr; encrypted-media",style:{height:"100%",width:"100%",border:"0"}})))}h.isMDXComponent=!0}}]);